--===

-- Citadel Sector Data Analyst Prep - Window Function Drills (core part of this apparently)

-- Covers all 6 required window function operations for financial analysis

-- ===

-- Setup Section

-- Create main stock prices table + company info table

CREATE TABLE stock_prices (
    symbol VARCHAR(10),
    date DATE,
    open_price DECIMAL(10,2),
    high_price DECIMAL(10,2),
    low_price DECIMAL(10,2),
    close_price DECIMAL(10,2),
    volume BIGINT,
    PRIMARY KEY (symbol, date)
)

CREATE TABLE company_info (
    symbol VARCHAR(10) PRIMARY KEY,
    company_name VARCHAR(100),
    sector VARCHAR(50),
    market_cap BIGINT
)

-- Insert Company Data into company_info 

INSERT INTO company_info VALUES 
('APPL', 'Apple Inc', 'Technology', 3000000000000),
('MSFT', 'Microsoft Corp', 'Technology', 2800000000000),
('GOOGL', 'Alphabet Inc', 'Technology', 1700000000000),
('AMZN', 'Amazon.com Inc', 'Consumer Discretionary', 1500000000000),
('TSLA', 'Tesla Inc', 'Consumer Discretionary', 800000000000),
('JPM', 'JPMorgan Chase', 'Financials', 500000000000),
('BAC', 'Bank of America', 'Financials', 300000000000),
('WFC', 'Wells Fargo', 'Financials', 200000000000),
('JNJ', 'Johnson & Johnson', 'Healthcare', 450000000000),
('PFE', 'Pfizer Inc', 'Healthcare', 280000000000);

-- Insert Stock Data into stock_price

-- Extended 30-day stock price data for January 2024
-- Includes all trading days (excluding weekends and MLK Day Jan 15)

INSERT INTO stock_prices VALUES 
-- AAPL data (continuing from 195.30)
('AAPL', '2024-01-01', 185.50, 188.20, 184.30, 187.80, 52000000),
('AAPL', '2024-01-02', 187.80, 190.15, 186.90, 189.45, 48000000),
('AAPL', '2024-01-03', 189.45, 191.80, 188.20, 190.25, 55000000),
('AAPL', '2024-01-04', 190.25, 192.50, 189.10, 188.90, 51000000),
('AAPL', '2024-01-05', 188.90, 191.40, 187.50, 191.20, 49000000),
('AAPL', '2024-01-08', 191.20, 193.80, 190.60, 193.45, 47000000),
('AAPL', '2024-01-09', 193.45, 195.20, 192.30, 194.80, 53000000),
('AAPL', '2024-01-10', 194.80, 196.50, 193.70, 195.30, 46000000),
('AAPL', '2024-01-11', 195.30, 197.80, 194.20, 196.85, 50000000),
('AAPL', '2024-01-12', 196.85, 198.40, 195.60, 197.90, 45000000),
('AAPL', '2024-01-16', 197.90, 199.70, 196.80, 198.55, 48000000),
('AAPL', '2024-01-17', 198.55, 200.20, 197.30, 199.40, 52000000),
('AAPL', '2024-01-18', 199.40, 201.80, 198.10, 200.75, 54000000),
('AAPL', '2024-01-19', 200.75, 202.50, 199.90, 201.20, 49000000),
('AAPL', '2024-01-22', 201.20, 203.60, 200.40, 202.85, 51000000),
('AAPL', '2024-01-23', 202.85, 204.70, 201.50, 203.95, 47000000),
('AAPL', '2024-01-24', 203.95, 205.80, 202.60, 204.30, 53000000),
('AAPL', '2024-01-25', 204.30, 206.20, 203.10, 205.60, 48000000),
('AAPL', '2024-01-26', 205.60, 207.40, 204.80, 206.85, 50000000),
('AAPL', '2024-01-29', 206.85, 208.90, 205.70, 207.50, 52000000),
('AAPL', '2024-01-30', 207.50, 209.30, 206.20, 208.80, 49000000),
('AAPL', '2024-01-31', 208.80, 210.50, 207.90, 209.25, 55000000),
('MSFT', '2024-01-01', 375.20, 378.90, 374.10, 377.50, 28000000),
('MSFT', '2024-01-02', 377.50, 380.25, 376.80, 379.15, 25000000),
('MSFT', '2024-01-03', 379.15, 382.40, 378.20, 381.60, 31000000),
('MSFT', '2024-01-04', 381.60, 383.80, 380.30, 382.95, 27000000),
('MSFT', '2024-01-05', 382.95, 385.10, 381.40, 384.25, 29000000),
('MSFT', '2024-01-08', 384.25, 387.60, 383.50, 386.80, 26000000),
('MSFT', '2024-01-09', 386.80, 389.20, 385.90, 388.45, 32000000),
('MSFT', '2024-01-10', 388.45, 391.30, 387.60, 390.15, 24000000),
('MSFT', '2024-01-11', 390.15, 392.80, 389.30, 391.65, 27000000),
('MSFT', '2024-01-12', 391.65, 394.20, 390.40, 393.50, 25000000),
('MSFT', '2024-01-16', 393.50, 396.10, 392.70, 395.25, 29000000),
('MSFT', '2024-01-17', 395.25, 397.90, 394.10, 396.80, 31000000),
('MSFT', '2024-01-18', 396.80, 399.40, 395.60, 398.15, 28000000),
('MSFT', '2024-01-19', 398.15, 400.80, 397.20, 399.70, 26000000),
('MSFT', '2024-01-22', 399.70, 402.30, 398.90, 401.45, 30000000),
('MSFT', '2024-01-23', 401.45, 404.10, 400.60, 403.20, 27000000),
('MSFT', '2024-01-24', 403.20, 405.80, 402.40, 404.95, 32000000),
('MSFT', '2024-01-25', 404.95, 407.50, 403.70, 406.30, 29000000),
('MSFT', '2024-01-26', 406.30, 408.90, 405.50, 407.85, 25000000),
('MSFT', '2024-01-29', 407.85, 410.40, 406.60, 409.15, 28000000),
('MSFT', '2024-01-30', 409.15, 411.70, 408.30, 410.90, 31000000),
('MSFT', '2024-01-31', 410.90, 413.50, 409.80, 412.25, 26000000),
('GOOGL', '2024-01-01', 140.50, 142.80, 139.90, 142.15, 35000000),
('GOOGL', '2024-01-02', 142.15, 144.60, 141.30, 143.85, 38000000),
('GOOGL', '2024-01-03', 143.85, 146.20, 142.90, 145.70, 41000000),
('GOOGL', '2024-01-04', 145.70, 147.40, 144.80, 146.90, 36000000),
('GOOGL', '2024-01-05', 146.90, 149.20, 145.60, 148.35, 39000000),
('GOOGL', '2024-01-08', 148.35, 150.80, 147.40, 149.95, 37000000),
('GOOGL', '2024-01-09', 149.95, 152.30, 148.70, 151.60, 42000000),
('GOOGL', '2024-01-10', 151.60, 153.90, 150.20, 152.85, 34000000),
('GOOGL', '2024-01-11', 152.85, 155.20, 151.70, 154.40, 40000000),
('GOOGL', '2024-01-12', 154.40, 156.80, 153.20, 155.95, 38000000),
('GOOGL', '2024-01-16', 155.95, 158.30, 154.60, 157.50, 43000000),
('GOOGL', '2024-01-17', 157.50, 159.90, 156.30, 158.75, 41000000),
('GOOGL', '2024-01-18', 158.75, 161.20, 157.40, 160.30, 45000000),
('GOOGL', '2024-01-19', 160.30, 162.70, 159.10, 161.85, 39000000),
('GOOGL', '2024-01-22', 161.85, 164.20, 160.60, 163.40, 42000000),
('GOOGL', '2024-01-23', 163.40, 165.80, 162.10, 164.95, 40000000),
('GOOGL', '2024-01-24', 164.95, 167.30, 163.70, 166.50, 44000000),
('GOOGL', '2024-01-25', 166.50, 168.90, 165.20, 167.80, 37000000),
('GOOGL', '2024-01-26', 167.80, 170.20, 166.50, 169.35, 46000000),
('GOOGL', '2024-01-29', 169.35, 171.70, 168.10, 170.90, 41000000),
('GOOGL', '2024-01-30', 170.90, 173.30, 169.60, 172.45, 43000000),
('GOOGL', '2024-01-31', 172.45, 174.80, 171.20, 173.60, 38000000),
('JPM', '2024-01-01', 165.80, 168.20, 164.90, 167.45, 15000000),
('JPM', '2024-01-02', 167.45, 169.80, 166.30, 168.90, 18000000),
('JPM', '2024-01-03', 168.90, 171.20, 167.60, 170.35, 16000000),
('JPM', '2024-01-04', 170.35, 172.80, 169.20, 171.60, 19000000),
('JPM', '2024-01-05', 171.60, 174.10, 170.40, 173.25, 17000000),
('JPM', '2024-01-08', 173.25, 175.90, 172.10, 174.80, 20000000),
('JPM', '2024-01-09', 174.80, 177.30, 173.50, 176.15, 14000000),
('JPM', '2024-01-10', 176.15, 178.60, 174.90, 177.40, 21000000),
('JPM', '2024-01-11', 177.40, 179.80, 176.20, 178.95, 18000000),
('JPM', '2024-01-12', 178.95, 181.30, 177.70, 180.50, 16000000),
('JPM', '2024-01-16', 180.50, 182.90, 179.30, 181.75, 22000000),
('JPM', '2024-01-17', 181.75, 184.20, 180.50, 183.60, 19000000),
('JPM', '2024-01-18', 183.60, 186.00, 182.40, 185.25, 17000000),
('JPM', '2024-01-19', 185.25, 187.70, 184.10, 186.80, 20000000),
('JPM', '2024-01-22', 186.80, 189.20, 185.60, 188.45, 15000000),
('JPM', '2024-01-23', 188.45, 190.90, 187.30, 189.70, 23000000),
('JPM', '2024-01-24', 189.70, 192.10, 188.50, 191.35, 18000000),
('JPM', '2024-01-25', 191.35, 193.80, 190.20, 192.90, 21000000),
('JPM', '2024-01-26', 192.90, 195.30, 191.70, 194.55, 16000000),
('JPM', '2024-01-29', 194.55, 197.00, 193.40, 195.80, 19000000),
('JPM', '2024-01-30', 195.80, 198.20, 194.60, 197.45, 22000000),
('JPM', '2024-01-31', 197.45, 199.90, 196.30, 198.70, 17000000),
('TSLA', '2024-01-01', 248.50, 255.20, 245.80, 252.30, 85000000),
('TSLA', '2024-01-02', 252.30, 258.90, 249.10, 256.70, 92000000),
('TSLA', '2024-01-03', 256.70, 262.40, 253.20, 259.85, 88000000),
('TSLA', '2024-01-04', 259.85, 264.60, 256.30, 261.40, 95000000),
('TSLA', '2024-01-05', 261.40, 267.80, 258.90, 265.25, 87000000),
('TSLA', '2024-01-08', 265.25, 271.50, 262.70, 268.90, 91000000),
('TSLA', '2024-01-09', 268.90, 274.20, 265.40, 271.60, 89000000),
('TSLA', '2024-01-10', 271.60, 276.80, 268.30, 273.15, 93000000),
('TSLA', '2024-01-11', 273.15, 278.90, 270.40, 276.50, 96000000),
('TSLA', '2024-01-12', 276.50, 282.30, 273.80, 279.85, 88000000),
('TSLA', '2024-01-16', 279.85, 285.60, 276.20, 283.40, 102000000),
('TSLA', '2024-01-17', 283.40, 289.10, 280.70, 286.75, 94000000),
('TSLA', '2024-01-18', 286.75, 292.50, 283.90, 290.20, 98000000),
('TSLA', '2024-01-19', 290.20, 295.80, 287.60, 293.65, 91000000),
('TSLA', '2024-01-22', 293.65, 299.40, 290.90, 297.10, 105000000),
('TSLA', '2024-01-23', 297.10, 302.80, 294.30, 300.55, 87000000),
('TSLA', '2024-01-24', 300.55, 306.20, 297.80, 304.00, 99000000),
('TSLA', '2024-01-25', 304.00, 309.70, 301.20, 307.45, 92000000),
('TSLA', '2024-01-26', 307.45, 313.10, 304.80, 310.90, 96000000),
('TSLA', '2024-01-29', 310.90, 316.60, 308.20, 314.35, 89000000),
('TSLA', '2024-01-30', 314.35, 320.00, 311.70, 317.80, 103000000),
('TSLA', '2024-01-31', 317.80, 323.50, 315.10, 321.25, 95000000);

-- Setup Complete with Sample Data in Table

-- DRILL 1:
-- Calculate daily returns using LAG function
-- Add columns for previous days price
-- Calculate daily returns % 
-- Calculate next day price

-- KEY FUNCTIONS: LAG(), LEAD(), PARTITION BY, ORDER BY

-- DRILL 1 SOLUTION:

